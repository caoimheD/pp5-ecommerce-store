{% extends "base.html" %}
{% load static %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'products/css/products.css' %}">
{% endblock %}

{% block content %}

<!-- Messages -->

<div class="container">
  <div class="row">
    <div class="col-md-8 offset-md-2">
      {% for message in messages %}
      <div class="alert {{ message.tags }} alert-dismissible fade show" id="msg" role="alert">
        {{ message | safe }}
      </div>
      {% endfor %}
    </div>
  </div>
</div>

<div class="container-fluid">

  <div class="row">

    <div class="col-sm-4 text-center">
      <!-- Admin buttons -->
      <a href={% url 'updateproduct' productdetails.id %} class="button active" role="button"
        aria-pressed="true">Edit</a>
      <a href={% url 'deleteproduct' productdetails.id %} class="button active" role="button"
        aria-pressed="true">Delete</a>
      <br>
      {% if productdetails.image %}
      <img src="{{ productdetails.image.url }}" alt="{{ product.title }}" class="img-fluid card-img-top image">
      {% else %}
      <img class="card-img-top img-fluid image" src="{% static 'media/blank.jpg' %}" alt="{{ product.title }}">
      {% endif %}
      <br>
      <!--Add to cart form-->
      <form class="form" action="{% url 'add_to_cart' productdetails.id %}" method="POST">
        {% csrf_token %}
        <div class="form-group">
          <p><i class="fa-solid fa-cart-shopping"></i> Quantity:</p>
          <input class="form-control-sm" type="number" name="quantity" value="1" min="1" max="99"
            data-item_id="{{ product.id }}" id="id_qty_{{ product.id }}">
        </div>
        <div class="form-group">
          <input type="submit" class="btn btn-link addcart text-uppercase" value="Add to Cart">
          <input type="hidden" name="redirect_url" value="{{ request.path }}">
        </div>
      </form>
    </div>
    <!--Product details-->
    <div class="col-sm">
      <h3>{{ productdetails.title }} - â‚¬{{ productdetails.price }}</h3>
      <ul class="list-group">

        <li class="list-group-item bookdetails">Category: {{ productdetails.category }}</li>
        <li class="list-group-item bookdetails">Title: {{ productdetails.title }}</li>
        <li class="list-group-item bookdetails">Author: {{ productdetails.author }}</li>
        <li class="list-group-item bookdetails">Description: {{ productdetails.description }}</li>
        <li class="list-group-item bookdetails">ISBN: {{ productdetails.sku }}</li>
      </ul>
      <br>
    </div>

    <div class="col-sm">
      <!-- Reviews -->
      <h4>Reviews</h4>

      {% for review in productdetails.review_set.all %}

      <ul class="list-group" style="border-bottom: 2px solid #D95950;">

        <li class="list-group-item bookdetails">Name: {{ review.name }}</li>
        <li class="list-group-item bookdetails">Title: {{ review.title }}</li>
        <li class="list-group-item bookdetails">Rating(out of 5): {{ review.rating }}</li>
        <li class="list-group-item bookdetails">Review: {{ review.review }}</li>
        <a href={% url 'deletereview' review.id %}>Delete</a>
      </ul>
      
      {% endfor %}
      <br>
      <a href={% url 'createreview' productdetails.id %} class="btn addcart btn-link text-uppercase" role="button"
        aria-pressed="true">Review this book</a>
      <br>
    </div>
  </div>



</div>




<div class="row">

</div>


</div>


{% endblock %}

<!-- Success messages timeout -->
<script>
  setTimeout(function () {
    let messages = document.getElementById('msg');
    let alert = new bootstrap.Alert(messages);
    alert.close();
  }, 3000);
</script>